---
title: "Your Title"
format: 
  pdf:
    keep-tex: true
    include-in-header: 
       text: |
         \usepackage{fvextra}
         \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
include-before-body:
  text: |
    \RecustomVerbatimEnvironment{verbatim}{Verbatim}{
      showspaces = false,
      showtabs = false,
      breaksymbolleft={},
      breaklines
    }
---

**PS4:** Due Sat Nov 2 at 5:00PM Central. Worth 100 points. 

## Style Points (10 pts)

## Submission Steps (10 pts)






```{python}
import pandas as pd
import altair as alt
import geopandas as gpd

import time

import warnings 
warnings.filterwarnings('ignore')
alt.renderers.enable("png")
```
## Download and explore the Provider of Services (POS) file (10 pts)

1. 
```
PRVDR_CTGRY_SBTYP_CD = Sub-type of Provider
PRVDR_CTGRY_CD = Provider Category Code
PRVDR_NUM = CMS Certification Number
PGM_TRMNTN_CD = Termination Code
TRMNTN_EXPRTN_DT = Date the provider was terminated 
FAC_NAME = Facility Name
ZIP_CD = Zip code
STATE_CD = State Abbreviation
```
2. 

```{python}
# set path and read in the pos2016.csv file
pset_path = '/Users/katikaklinkaew/Documents/GitHub/problem-set-4-katika-and-liujun/data/'

# create a function to load, filter, and count number of short-term hospitals
def read_short_term_hospitals(year, pset_path):
    """
    read the provider-of-service data for a given year, filters for short-term hospitals,
    and returns the filtered DataFrame.
    
    Parameters:
        year (int): The year of the data (e.g., 2017).
        pset_path (str): The path to the directory containing the CSV files.

    """
    file_path = os.path.join(pset_path, f'pos{year}.csv')
    df = pd.read_csv(file_path, encoding='latin1')
    df = df[(df['PRVDR_CTGRY_CD'] == 1) & (df['PRVDR_CTGRY_SBTYP_CD'] == 1)]
    print(f'There are {df.shape[0]} short-term hospitals reported in {year} data')
    return df

```



    a. 
```{python}
df_pos2016 = read_short_term_hospitals(2016, pset_path)
df_pos2016
```
This number is too little.....
    b.

   
3. 

```{python}
# repeat the steps for each year
df_pos2017 = read_short_term_hospitals(2017, pset_path)
df_pos2018 = read_short_term_hospitals(2018, pset_path)
df_pos2019 = read_short_term_hospitals(2019, pset_path)

# append all the pos data
df_pos2017_to_2019 = pd.concat([df_pos2016.assign(year = 2016), df_pos2017.assign(year = 2017), df_pos2018.assign(year = 2018), df_pos2019.assign(year = 2019)], ignore_index=True)

```

```{python}
# plot number of observations by year
observation_by_year= df_pos2017_to_2019.groupby('year').size().reset_index(name='count')

observation_by_year_plot = alt.Chart(observation_by_year).mark_bar(
    ).encode(
        alt.Y('year:O', title='Year'),
        alt.X('count:Q', title='Number of Observations')
    ).properties(
        title='Providers of Service',
    )

observation_label = observation_by_year_plot.mark_text(
    align = 'left',
    baseline = 'bottom',
    dx = 5,
    dy = 5,
    fontSize = 10
    ).encode(
    text = 'count:Q'
    )

observation_by_year_plot + observation_label
```



4. 
    a.
```{python}
# plot number of unique hospitals by year
unique_hospital_by_year= df_pos2017_to_2019.groupby('year')['PRVDR_NUM'].nunique().reset_index(name='unique_hospital_count')


unique_hospital_by_year_plot = alt.Chart(unique_hospital_by_year).mark_bar(
    ).encode(
        alt.Y('year:O', title='Year'),
        alt.X('unique_hospital_count:Q', title='Number of unique hospitals')
    ).properties(
        title='Total unique hospitals by year',
    )

unique_label = unique_hospital_by_year_plot.mark_text(
    align = 'left',
    baseline = 'bottom',
    dx = 5,
    dy = 5,
    fontSize = 10
    ).encode(
    text = 'unique_hospital_count:Q'
    )
unique_hospital_by_year_plot + unique_label
```
    b. 

```{python}
observation_by_year_plot + observation_label  | unique_hospital_by_year_plot + unique_label
```
From the two plots, we can see that the number of unique hospitals is exactly the same as the number of observations in each year. It tells us that a hospital only appears in the data once in a specific year, that is each row in each year represents a snapshot of a unique hospotal.

## Identify hospital closures in POS file (15 pts) (*)

1. 
2. 
3. 
    a.
    b.
    c.

## Download Census zip code shapefile (10 pt) 

1. 
    a.



| File Type | Information Type |
| .dbf| Attribute information |
| .prj | Coordinate Reference System (CRS) description |
| .shp | Geometric or Spatial data (i.e., points, polygon) |
| .shx | Positional index |
| .xml |  |

    b. 
2. 

## Calculate zip codeâ€™s distance to the nearest hospital (20 pts) (*)

1. 
2. 
3. 
4. 
    a.
    b.
    c.
5. 
    a.
    b.
    c.
    
## Effects of closures on access in Texas (15 pts)

1. 
2. 
3. 
4. 

## Reflecting on the exercise (10 pts) 
